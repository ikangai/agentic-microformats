<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('partials/head') %>
</head>
<body>
  <%- include('partials/header') %>

  <main data-agent-trust="system">
    <h1>Product Catalog</h1>
    <p>Browse our selection of premium tech accessories.</p>

    <div class="product-grid">
      <% products.forEach(product => { %>
      <article class="product-card"
               data-agent="resource"
               data-agent-type="product"
               data-agent-id="<%= product.id %>">

        <a href="/product/<%= product.id %>">
          <h2 data-agent-prop="name"><%= product.name %></h2>
        </a>

        <p data-agent-prop="description" class="product-description"><%= product.description %></p>

        <div class="product-meta">
          <span class="price"
                data-agent-prop="price"
                data-agent-typehint="currency"
                data-agent-currency="EUR">&euro;<%= product.price.toFixed(2) %></span>

          <span class="availability availability-<%= product.availability %>"
                data-agent-prop="availability"><%= product.availability.replaceAll('_', ' ') %></span>
        </div>

        <div class="product-meta">
          <span class="rating"
                data-agent-prop="rating"
                data-agent-typehint="number"><%= product.rating %></span> / 5
          (<span data-agent-prop="rating_count"
                 data-agent-typehint="integer"><%= product.ratingCount %></span> reviews)
        </div>

        <form class="product-actions"
              data-agent="action"
              data-agent-name="add_to_cart"
              data-agent-method="POST"
              data-agent-endpoint="/api/cart/add"
              data-agent-headers='{"Content-Type":"application/json"}'
              data-agent-role="primary"
              data-agent-risk="low"
              data-agent-description="Add this product to the shopping cart"
              data-agent-on-success="Item added to cart. Cart count and total updated in response. Navigate to /cart to view cart."
              data-agent-response='{"success":"boolean","message":"string","cartItemId":"string","cartCount":"integer","cartTotal":"number"}'>

          <input data-agent-param="product_id"
                 type="hidden"
                 name="product_id"
                 value="<%= product.id %>">

          <label>
            Qty:
            <input data-agent-param="quantity"
                   data-agent-typehint="integer"
                   data-agent-min="1"
                   data-agent-max="10"
                   type="number"
                   name="quantity"
                   min="1" max="10" value="1"
                   required
                   class="qty-input">
          </label>

          <button type="submit" class="btn btn-primary">Add to Cart</button>
        </form>

        <a href="/product/<%= product.id %>" class="btn btn-secondary" style="margin-top:8px;text-align:center">View Details</a>
      </article>
      <% }) %>
    </div>
  </main>

  <%- include('partials/footer') %>
  <script src="/demo.js"></script>
</body>
</html>
